
<!DOCTYPE html>
<html lang="it">
<head>
    <title>Portale Verifiche</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1, h2 { color: #2c3e50; text-align: center; }
        
        /* LOGIN */
        input[type="email"] { width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-primary { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1rem; }
        .btn-primary:disabled { background: #ccc; cursor: wait; }
        .error-msg { color: #d9534f; display: none; text-align: center; margin-top: 15px; padding: 10px; background: #fde8e8; border-radius: 4px; }

        /* DASHBOARD */
        .dashboard-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        @media (max-width: 700px) { .dashboard-container { grid-template-columns: 1fr; } }
        
        .column-header { font-size: 1.5rem; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        
        .quiz-card { 
            border: 1px solid #e0e0e0; 
            border-left: 5px solid #007bff; 
            padding: 15px; margin-bottom: 15px; border-radius: 6px; 
            background: white; cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .quiz-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .type-math { border-left-color: #007bff; }
        .type-physics { border-left-color: #e83e8c; }
        .quiz-card.completed { border-left-color: #28a745; background-color: #f0fff4; opacity: 0.8; cursor: default; }
        
        .status-badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .badge-todo { background: #e7f1ff; color: #007bff; }
        .badge-done { background: #d4edda; color: #28a745; }

        /* QUIZ UI */
        .nav-scroll { display: flex; overflow-x: auto; gap: 5px; padding: 10px 0; border-top: 1px solid #eee; margin-top: 20px; }
        .nav-box { min-width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; background: #eee; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .nav-box.answered { background: #007bff; color: white; }
        .nav-box.current { border: 2px solid #ffc107; }
        .answer-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 6px; background: white; cursor: pointer; text-align: left; }
        .answer-btn.selected { border-color: #007bff; background: #e7f1ff; }
        .nav-container { display: flex; justify-content: space-between; margin-top: 20px; }
        #timer { font-family: monospace; font-size: 1.5rem; color: #d9534f; float: right; }
        #loading { display: none; text-align: center; }
    </style>
</head>
<body>

    <div id="view-login" class="card">
        <h1>Portale Studenti</h1>
        <p style="text-align:center">Accedi con la tua email istituzionale.</p>
        <input type="email" id="input-email" placeholder="nome.cognome@scuola.it">
        <button id="btn-login" class="btn-primary" onclick="attemptLogin()">Entra</button>
        <div id="login-error" class="error-msg"></div>
    </div>

    <div id="view-dashboard" class="card" style="display:none; max-width: 1200px;">
        <h2 id="welcome-msg">Benvenuto</h2>
        <div class="dashboard-container">
            <div>
                <div class="column-header">üìê Matematica</div>
                <div id="list-math"></div>
            </div>
            <div>
                <div class="column-header">‚öõÔ∏è Fisica</div>
                <div id="list-physics"></div>
            </div>
        </div>
    </div>

    <div id="view-quiz" class="card" style="display:none;">
        <div style="overflow:hidden; margin-bottom:15px;">
            <span id="quiz-title" style="font-weight:bold; font-size:1.2em;">Titolo</span>
            <span id="timer">60:00</span>
        </div>
        <div id="question-container"></div>
        <div class="nav-container">
            <button id="prev-btn" class="btn-primary" style="background:#6c757d; width:auto;" onclick="move(-1)">Indietro</button>
            <button id="next-btn" class="btn-primary" style="width:auto;" onclick="move(1)">Avanti</button>
            <button id="submit-btn" class="btn-primary" style="background:#28a745; width:auto; display:none;" onclick="submitQuiz()">Consegna</button>
        </div>
        <div id="nav-scroll" class="nav-scroll"></div>
    </div>
    
    <div id="loading" class="card"><h3>Salvataggio in corso...</h3></div>

    <script>
        // INIEZIONE DATI SICURA (Placeholders verranno sostituiti da Python)
        const LIBRARY = {"physics_QuantitiesKinematics": [{"question": "Which of the following is a base quantity in the International System of Units (SI)?", "answers": [{"text": "Electric charge", "correct": false}, {"text": "Force", "correct": false}, {"text": "Velocity", "correct": false}, {"text": "Electric current", "correct": true}]}, {"question": "What is the dimensional formula for Force?", "answers": [{"text": "\\([M^0LT^{-2}]\\)", "correct": false}, {"text": "\\([ML^2T^{-2}]\\) ", "correct": false}, {"text": "\\([MLT^{-1}]\\) ", "correct": false}, {"text": "\\([MLT^{-2}]\\) ", "correct": true}]}, {"question": "Which of the following pairs contains only vector quantities?", "answers": [{"text": "Mass and Momentum", "correct": false}, {"text": "Speed and Velocity", "correct": false}, {"text": "Force and Work", "correct": false}, {"text": "Displacement and Acceleration", "correct": true}]}, {"question": "Convert \\(72 \\, km/h\\) into \\(m/s\\).", "answers": [{"text": "\\(10 \\, m/s\\)", "correct": false}, {"text": "\\(20 \\, m/s\\)", "correct": true}, {"text": "\\(25 \\, m/s\\)", "correct": false}, {"text": "\\(15 \\, m/s\\)", "correct": false}]}, {"question": "Two vectors with magnitudes 3 and 4 are perpendicular. What is the magnitude of their resultant?", "answers": [{"text": "\\(1\\)", "correct": false}, {"text": "\\(12\\)", "correct": false}, {"text": "\\(5\\)", "correct": true}, {"text": "\\(7\\)", "correct": false}]}, {"question": "The order of magnitude of the number 0.0034 is:", "answers": [{"text": "\\(10^{-3}\\)", "correct": true}, {"text": "\\(10^{3}\\)", "correct": false}, {"text": "\\(10^{-2}\\)", "correct": false}, {"text": "\\(10^{-4}\\)", "correct": false}]}, {"question": "A car travels 100 meters North and then 100 meters East. What is the magnitude of the total displacement?", "answers": [{"text": "\\(0 \\, m\\)", "correct": false}, {"text": "\\(100\\sqrt{2} \\, m\\)", "correct": true}, {"text": "\\(100 \\, m\\)", "correct": false}, {"text": "\\(200 \\, m\\)", "correct": false}]}, {"question": "Which of the following equations is dimensionally consistent (where \\(x\\) is distance, \\(v\\) is velocity, \\(a\\) is acceleration, \\(t\\) is time)?", "answers": [{"text": "\\(x = \\frac{1}{2}at^2\\)", "correct": true}, {"text": "\\(v^2 = 2ax^2\\)", "correct": false}, {"text": "\\(t = \\sqrt{a/x}\\)", "correct": false}, {"text": "\\(v = ax\\)", "correct": false}]}, {"question": "An object moves with constant velocity. Which statement is true?", "answers": [{"text": "The average velocity is different from instantaneous velocity.", "correct": false}, {"text": "The acceleration is zero.", "correct": true}, {"text": "The speed changes direction.", "correct": false}, {"text": "The displacement is always zero.", "correct": false}]}, {"question": "A car accelerates from rest at \\(2 \\, m/s^2\\). How long does it take to reach a speed of \\(20 \\, m/s\\)?", "answers": [{"text": "\\(20 \\, s\\)", "correct": false}, {"text": "\\(10 \\, s\\)", "correct": true}, {"text": "\\(40 \\, s\\)", "correct": false}, {"text": "\\(5 \\, s\\)", "correct": false}]}, {"question": "If the velocity of a particle is given by \\(v(t) = 4 - 2t\\), at what time does the particle stop?", "answers": [{"text": "\\(4 \\, s\\)", "correct": false}, {"text": "\\(1 \\, s\\)", "correct": false}, {"text": "\\(2 \\, s\\)", "correct": true}, {"text": "\\(0 \\, s\\)", "correct": false}]}, {"question": "An object is dropped from a height. If air resistance is neglected, the distance fallen is proportional to:", "answers": [{"text": "\\(t\\)", "correct": false}, {"text": "\\(t^2\\)", "correct": true}, {"text": "\\(\\sqrt{t}\\)", "correct": false}, {"text": "\\(1/t\\)", "correct": false}]}, {"question": "A stone is dropped from a tower and reaches the ground in 4 seconds. What is the height of the tower? (Assume \\(g = 10 \\, m/s^2\\))", "answers": [{"text": "\\(40 \\, m\\)", "correct": false}, {"text": "\\(80 \\, m\\)", "correct": true}, {"text": "\\(20 \\, m\\)", "correct": false}, {"text": "\\(160 \\, m\\)", "correct": false}]}, {"question": "An object is thrown vertically upwards with a speed of \\(30 \\, m/s\\). How much time does it take to return to the thrower's hand? (Assume \\(g = 10 \\, m/s^2\\))", "answers": [{"text": "\\(1.5 \\, s\\)", "correct": false}, {"text": "\\(6 \\, s\\)", "correct": true}, {"text": "\\(3 \\, s\\)", "correct": false}, {"text": "\\(9 \\, s\\)", "correct": false}]}, {"question": "What represents the area under a Velocity-Time graph?", "answers": [{"text": "Force", "correct": false}, {"text": "Speed", "correct": false}, {"text": "Acceleration", "correct": false}, {"text": "Displacement", "correct": true}]}, {"question": "A car traveling at \\(v\\) stops in distance \\(d\\) under constant braking. If the initial speed was \\(2v\\), the stopping distance would be:", "answers": [{"text": "\\(d/2\\)", "correct": false}, {"text": "\\(2d\\)", "correct": false}, {"text": "\\(d\\)", "correct": false}, {"text": "\\(4d\\)", "correct": true}]}, {"question": "In a projectile motion (neglecting air resistance), which component of velocity remains constant?", "answers": [{"text": "Both components", "correct": false}, {"text": "The horizontal component", "correct": true}, {"text": "The vertical component", "correct": false}, {"text": "Neither component", "correct": false}]}, {"question": "A projectile is fired at an angle of \\(45^\\circ\\) with initial velocity \\(v_0\\). What is its range?", "answers": [{"text": "\\(v_0/g\\)", "correct": false}, {"text": "\\(2v_0/g\\)", "correct": false}, {"text": "\\(v_0^2/g\\)", "correct": true}, {"text": "\\(v_0^2/2g\\)", "correct": false}]}, {"question": "At the maximum height of a projectile's trajectory, the velocity vector is:", "answers": [{"text": "Vertical", "correct": false}, {"text": "Zero", "correct": false}, {"text": "At \\(45^\\circ\\) to the horizontal", "correct": false}, {"text": "Horizontal", "correct": true}]}, {"question": "If a ball is thrown horizontally from a cliff with speed \\(v\\) and another is dropped from the same height simultaneously:", "answers": [{"text": "It depends on the mass of the balls.", "correct": false}, {"text": "The dropped ball hits the ground first.", "correct": false}, {"text": "Both hit the ground at the same time.", "correct": true}, {"text": "The thrown ball hits the ground first.", "correct": false}]}, {"question": "For a projectile, the maximum range is obtained when the angle of projection is:", "answers": [{"text": "\\(60^\\circ\\)", "correct": false}, {"text": "\\(90^\\circ\\)", "correct": false}, {"text": "\\(30^\\circ\\)", "correct": false}, {"text": "\\(45^\\circ\\)", "correct": true}]}, {"question": "A particle moves in a circle of radius \\(r\\) with constant speed \\(v\\). What is its centripetal acceleration?", "answers": [{"text": "\\(v^2 r\\)", "correct": false}, {"text": "\\(r/v\\)", "correct": false}, {"text": "\\(v/r\\)", "correct": false}, {"text": "\\(v^2/r\\)", "correct": true}]}, {"question": "If the period of a uniform circular motion is doubled, the angular velocity:", "answers": [{"text": "Doubles", "correct": false}, {"text": "Remains the same", "correct": false}, {"text": "Quadruples", "correct": false}, {"text": "Is halved", "correct": true}]}, {"question": "A car moves around a circular track of radius \\(100 \\, m\\) at a constant speed of \\(20 \\, m/s\\). What is the angular velocity?", "answers": [{"text": "\\(5 \\, rad/s\\)", "correct": false}, {"text": "\\(2000 \\, rad/s\\)", "correct": false}, {"text": "\\(0.2 \\, rad/s\\)", "correct": true}, {"text": "\\(0.02 \\, rad/s\\)", "correct": false}]}, {"question": "In uniform circular motion, the velocity vector and acceleration vector are always:", "answers": [{"text": "Parallel to each other", "correct": false}, {"text": "Perpendicular to each other", "correct": true}, {"text": "In opposite directions", "correct": false}, {"text": "At \\(45^\\circ\\) to each other", "correct": false}]}, {"question": "An object travels half a circle of radius \\(R\\). What is the magnitude of its displacement?", "answers": [{"text": "\\(2R\\)", "correct": true}, {"text": "\\(0\\)", "correct": false}, {"text": "\\(\\pi R\\)", "correct": false}, {"text": "\\(R\\)", "correct": false}]}, {"question": "A swimmer crosses a river flowing at \\(3 \\, m/s\\) by swimming perpendicular to the current at \\(4 \\, m/s\\). What is the swimmer's speed relative to the ground?", "answers": [{"text": "\\(5 \\, m/s\\)", "correct": true}, {"text": "\\(7 \\, m/s\\)", "correct": false}, {"text": "\\(\\sqrt{7} \\, m/s\\)", "correct": false}, {"text": "\\(1 \\, m/s\\)", "correct": false}]}, {"question": "Which derived unit corresponds to the product of Mass and Acceleration?", "answers": [{"text": "Newton", "correct": true}, {"text": "Joule", "correct": false}, {"text": "Watt", "correct": false}, {"text": "Pascal", "correct": false}]}, {"question": "If \\(x = kt^3\\), what is the acceleration at time \\(t\\)?", "answers": [{"text": "\\(6kt\\)", "correct": true}, {"text": "\\(k\\)", "correct": false}, {"text": "\\(6k\\)", "correct": false}, {"text": "\\(3kt^2\\)", "correct": false}]}, {"question": "A wheel rotates with a frequency of \\(2 \\, Hz\\). What is its period?", "answers": [{"text": "\\(0.5 \\, s\\)", "correct": true}, {"text": "\\(0.25 \\, s\\)", "correct": false}, {"text": "\\(4 \\pi \\, s\\)", "correct": false}, {"text": "\\(2 \\, s\\)", "correct": false}]}], "math_algebra": [{"question": "Evaluate the expression: \\((27/8)^{-2/3} + (1/16)^{-0.75}\\)", "answers": [{"text": "\\(20/9\\)", "correct": true}, {"text": "\\(12/5\\)", "correct": false}, {"text": "\\(68\\)", "correct": false}, {"text": "\\(4/9\\)", "correct": false}]}, {"question": "Which of the following numbers is the largest?", "answers": [{"text": "\\(\\sqrt{2}\\)", "correct": false}, {"text": "\\(\\sqrt[4]{4}\\)", "correct": false}, {"text": "\\(\\sqrt[6]{6}\\)", "correct": false}, {"text": "\\(\\sqrt[3]{3}\\)", "correct": true}]}, {"question": "Given that \\(a\\) and \\(b\\) are real numbers such that \\(0 < a < b < 1\\), which of the following inequalities is always true?", "answers": [{"text": "\\(a^2 < b^2\\)", "correct": true}, {"text": "\\(\\log_b(a) < 0\\)", "correct": false}, {"text": "\\(\\sqrt{a} > \\sqrt{b}\\)", "correct": false}, {"text": "\\(1/a < 1/b\\)", "correct": false}]}, {"question": "Simplify the expression \\(\\sqrt{72} - \\sqrt{18} + \\sqrt{50}\\).", "answers": [{"text": "\\(10\\sqrt{2}\\)", "correct": false}, {"text": "\\(6\\sqrt{2}\\)", "correct": false}, {"text": "\\(5\\sqrt{2}\\)", "correct": false}, {"text": "\\(8\\sqrt{2}\\)", "correct": true}]}, {"question": "Rationalize the denominator: \\(\\frac{2}{\\sqrt{3}-1}\\).", "answers": [{"text": "\\(2(\\sqrt{3}-1)\\)", "correct": false}, {"text": "\\(1\\)", "correct": false}, {"text": "\\(\\sqrt{3}-1\\)", "correct": false}, {"text": "\\(\\sqrt{3}+1\\)", "correct": true}]}, {"question": "If \\(\\log_{10}(x) = 3\\) and \\(\\log_{10}(y) = 2\\), what is the value of \\(\\log_{10}(x^2/y)\\)?", "answers": [{"text": "\\(5\\)", "correct": false}, {"text": "\\(4\\)", "correct": true}, {"text": "\\(1\\)", "correct": false}, {"text": "\\(8\\)", "correct": false}]}, {"question": "Solve for \\(x\\): \\(e^{2x} - 3e^x + 2 = 0\\).", "answers": [{"text": "\\(x = 0\\) only", "correct": false}, {"text": "\\(x = \\ln(2)\\) and \\(x = \\ln(3)\\)", "correct": false}, {"text": "\\(x = 0\\) and \\(x = \\ln(2)\\)", "correct": true}, {"text": "\\(x = 1\\) and \\(x = 2\\)", "correct": false}]}, {"question": "Which of the following is a factor of the polynomial \\(P(x) = x^3 - 2x^2 - 5x + 6\\)?", "answers": [{"text": "\\(x + 2\\)", "correct": false}, {"text": "\\(x - 2\\)", "correct": false}, {"text": "\\(x + 1\\)", "correct": false}, {"text": "\\(x - 3\\)", "correct": true}]}, {"question": "Simplify the algebraic fraction: \\(\\frac{x^2 - 9}{x^2 - 6x + 9}\\).", "answers": [{"text": "\\(\\frac{x+3}{x+3}\\)", "correct": false}, {"text": "\\(1\\)", "correct": false}, {"text": "\\(\\frac{x-3}{x+3}\\)", "correct": false}, {"text": "\\(\\frac{x+3}{x-3}\\)", "correct": true}]}, {"question": "Find the set of real values of \\(x\\) for which \\(\\sqrt{x^2 - 4x + 3}\\) is defined.", "answers": [{"text": "\\(1 \\leq x \\leq 3\\)", "correct": false}, {"text": "\\(x \\leq 1\\) or \\(x \\geq 3\\)", "correct": true}, {"text": "\\(x > 3\\)", "correct": false}, {"text": "\\(x \\geq 0\\)", "correct": false}]}, {"question": "Solve the inequality: \\(\\frac{x+1}{x-2} \\leq 0\\).", "answers": [{"text": "\\((-1, 2]\\)", "correct": false}, {"text": "\\([-1, 2]\\)", "correct": false}, {"text": "\\([-1, 2)\\)", "correct": true}, {"text": "\\((- \\infty, -1] \\cup (2, \\infty)\\)", "correct": false}]}, {"question": "If \\(x = \\sqrt{3} + 1\\), what is the value of \\(x^2 - 2x\\)?", "answers": [{"text": "\\(2\\sqrt{3}\\)", "correct": false}, {"text": "\\(\\sqrt{3}\\)", "correct": false}, {"text": "\\(2\\)", "correct": true}, {"text": "\\(4\\)", "correct": false}]}, {"question": "Solve the inequality \\(\\frac{3}{x} \\geq 1\\).", "answers": [{"text": "\\(x < 0\\) or \\(x \\geq 3\\)", "correct": false}, {"text": "\\(x \\geq 3\\)", "correct": false}, {"text": "\\(0 < x \\leq 3\\)", "correct": true}, {"text": "\\(x \\leq 3\\)", "correct": false}]}, {"question": "Which of the following expressions is equivalent to \\(\\ln(e^3 \\cdot \\sqrt{e})\\)?", "answers": [{"text": "\\(1.5\\)", "correct": false}, {"text": "\\(e^{3.5}\\)", "correct": false}, {"text": "\\(3.5\\)", "correct": true}, {"text": "\\(3\\)", "correct": false}]}, {"question": "Determine the solution set for \\(|2x - 1| < 5\\).", "answers": [{"text": "\\((-\\infty, -2) \\cup (3, \\infty)\\)", "correct": false}, {"text": "\\((-3, 2)\\)", "correct": false}, {"text": "\\([-2, 3]\\)", "correct": false}, {"text": "\\((-2, 3)\\)", "correct": true}]}, {"question": "For what values of \\(k\\) does the equation \\(x^2 + kx + 9 = 0\\) have exactly one real solution?", "answers": [{"text": "\\(k = \\pm 6\\)", "correct": true}, {"text": "\\(k = 6\\)", "correct": false}, {"text": "\\(k = 9\\)", "correct": false}, {"text": "\\(k = \\pm 3\\)", "correct": false}]}, {"question": "Calculate the value of \\( \\log_2(8\\sqrt{2}) \\).", "answers": [{"text": "\\(3.5\\)", "correct": true}, {"text": "\\(4\\)", "correct": false}, {"text": "\\(2.5\\)", "correct": false}, {"text": "\\(3\\)", "correct": false}]}, {"question": "Simplify: \\( (a^{2/3} b^{-1/2})^6 \\).", "answers": [{"text": "\\(a^{8/3} b^{-6}\\)", "correct": false}, {"text": "\\(a^4 b^3\\)", "correct": false}, {"text": "\\(a^8 / b^3\\)", "correct": false}, {"text": "\\(a^4 / b^3\\)", "correct": true}]}, {"question": "If \\(P(x) = 2x^3 - kx^2 + x - 3\\) is divisible by \\((x-1)\\), find \\(k\\).", "answers": [{"text": "\\(1\\)", "correct": false}, {"text": "\\(-1\\)", "correct": false}, {"text": "\\(0\\)", "correct": true}, {"text": "\\(2\\)", "correct": false}]}, {"question": "Solve the inequality: \\(3^{x+1} > 9^{x-1}\\).", "answers": [{"text": "\\(x < 2\\)", "correct": false}, {"text": "\\(x < 3\\)", "correct": true}, {"text": "\\(x > 1\\)", "correct": false}, {"text": "\\(x > 3\\)", "correct": false}]}, {"question": "What is the domain of the function \\(f(x) = \\ln(4 - x^2)\\)?", "answers": [{"text": "\\((-2, 2)\\)", "correct": true}, {"text": "\\(x > 2\\)", "correct": false}, {"text": "\\([-2, 2]\\)", "correct": false}, {"text": "\\((-\\infty, -2) \\cup (2, \\infty)\\)", "correct": false}]}, {"question": "Solve the equation \\(\\sqrt{x+2} = x\\).", "answers": [{"text": "\\(x = -1, x = 2\\)", "correct": false}, {"text": "\\(x = 4\\)", "correct": false}, {"text": "\\(x = 2\\)", "correct": true}, {"text": "\\(x = -1\\)", "correct": false}]}, {"question": "Which term is equivalent to \\( \\frac{1}{1 + \\sqrt{2}} + \\frac{1}{\\sqrt{2} + \\sqrt{3}} \\)?", "answers": [{"text": "\\(\\sqrt{3} + 1\\)", "correct": false}, {"text": "\\(1 - \\sqrt{3}\\)", "correct": false}, {"text": "\\(\\sqrt{3} - 1\\)", "correct": true}, {"text": "\\(\\frac{1}{1+\\sqrt{3}}\\)", "correct": false}]}, {"question": "Find the value of \\(x\\) satisfying \\( \\log_3(x-1) + \\log_3(x+1) = 1 \\).", "answers": [{"text": "\\(\\sqrt{2}\\)", "correct": false}, {"text": "\\(2\\)", "correct": true}, {"text": "\\(4\\)", "correct": false}, {"text": "\\(1\\)", "correct": false}]}, {"question": "Which of the following is an irrational number?", "answers": [{"text": "\\(\\frac{\\pi}{2}\\)", "correct": false}, {"text": "\\(\\sqrt{0.04}\\)", "correct": false}, {"text": "\\(\\sqrt{12} \\cdot \\sqrt{3}\\)", "correct": true}, {"text": "\\(3.\\overline{14}\\)", "correct": false}]}, {"question": "Solve the inequality: \\(x^2 - x - 6 > 0\\).", "answers": [{"text": "\\(x > 3\\)", "correct": false}, {"text": "\\(x < -2\\)", "correct": false}, {"text": "\\(-2 < x < 3\\)", "correct": false}, {"text": "\\(x < -2\\) or \\(x > 3\\)", "correct": true}]}, {"question": "If \\(2^{3x} = 0.25\\), what is \\(x\\)?", "answers": [{"text": "\\(-2\\)", "correct": false}, {"text": "\\(-2/3\\)", "correct": true}, {"text": "\\(-1/2\\)", "correct": false}, {"text": "\\(2/3\\)", "correct": false}]}, {"question": "The average of three numbers is \\( \\sqrt{3} \\). One number is \\(0\\), another is \\(2\\sqrt{3}\\). What is the third number?", "answers": [{"text": "\\(3\\sqrt{3}\\)", "correct": false}, {"text": "\\(1\\)", "correct": false}, {"text": "\\(\\sqrt{3}\\)", "correct": true}, {"text": "\\(3\\)", "correct": false}]}, {"question": "Perform the operation: \\( (2 \\times 10^{-3}) \\div (5 \\times 10^{-2}) \\).", "answers": [{"text": "\\(4 \\times 10^{-1}\\)", "correct": false}, {"text": "\\(4 \\times 10^{-2}\\)", "correct": true}, {"text": "\\(0.4 \\times 10^{-2}\\)", "correct": false}, {"text": "\\(2.5 \\times 10^{-1}\\)", "correct": false}]}, {"question": "What is the smallest integer \\(n\\) such that \\(2^n > 500\\)?", "answers": [{"text": "\\(8\\)", "correct": false}, {"text": "\\(10\\)", "correct": false}, {"text": "\\(7\\)", "correct": false}, {"text": "\\(9\\)", "correct": true}]}]}; 
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbxmPJxEshf-WLe2fA0Bq4YO6hbj7oR8bh2vguUIuIRzJiM8VdBARyYgVbBhOB1W_wgJ/exec";

        let currentUser = "";
        let currentQuizId = "";
        let questions = [];
        let answers = [];
        let currentIdx = 0;
        let timeLeft = 3600;
        let timerInterval;

        async function attemptLogin() {
            const email = document.getElementById('input-email').value.trim();
            const btn = document.getElementById('btn-login');
            
            if(!email.includes('@')) return showError("Email non valida.");
            btn.disabled = true;
            btn.innerText = "Controllo...";
            
            try {
                // Chiamata al Database Google Sheet
                const response = await fetch(GOOGLE_URL + "?email=" + encodeURIComponent(email));
                const result = await response.json();

                if (!result.allowed) {
                    showError("Email non presente nel database (Whitelist).");
                    btn.disabled = false;
                    btn.innerText = "Entra";
                    return;
                }

                currentUser = email;
                document.getElementById('welcome-msg').innerText = "Studente: " + email;
                
                // Genera la dashboard basandosi sui completati
                renderDashboard(result.completed); // result.completed deve essere una lista di ID (es: ["math_algebra"])

                document.getElementById('view-login').style.display = 'none';
                document.getElementById('view-dashboard').style.display = 'block';

            } catch (e) {
                console.error(e);
                showError("Errore di connessione o URL Script errato.");
                btn.disabled = false;
                btn.innerText = "Entra";
            }
        }

        function renderDashboard(completedList) {
            const mathList = document.getElementById('list-math');
            const physList = document.getElementById('list-physics');
            mathList.innerHTML = "";
            physList.innerHTML = "";

            // Ordina i quiz alfabeticamente
            const quizIds = Object.keys(LIBRARY).sort();

            if(quizIds.length === 0) {
                mathList.innerHTML = "<p>Nessun quiz caricato.</p>";
                return;
            }

            quizIds.forEach(quizId => {
                // quizId es: "math_algebra"
                const parts = quizId.split('_');
                const subject = parts[0]; // "math" o "physics"
                const topic = parts.slice(1).join(' ').toUpperCase(); // "ALGEBRA"
                
                // Controlla se √® nella lista dei completati
                const isDone = completedList && completedList.includes(quizId);
                
                const card = document.createElement('div');
                card.className = `quiz-card type-${subject} ${isDone ? 'completed' : ''}`;
                
                card.innerHTML = `
                    <div><strong>${topic}</strong></div>
                    <div class="status-badge ${isDone ? 'badge-done' : 'badge-todo'}">
                        ${isDone ? 'COMPLETATO' : 'AVVIA'}
                    </div>
                `;

                if (!isDone) {
                    card.onclick = () => startQuiz(quizId);
                } else {
                    card.title = "Hai gi√† completato questa verifica";
                }

                if (subject === 'math') mathList.appendChild(card);
                else if (subject === 'physics') physList.appendChild(card);
                else {
                    // Fallback per file con altri nomi (es. chimica_test.csv)
                    // Li mettiamo in Matematica per default o creiamo altra logica
                    mathList.appendChild(card); 
                }
            });
        }

        function startQuiz(quizId) {
            currentQuizId = quizId;
            questions = LIBRARY[quizId];
            answers = new Array(questions.length).fill(null);
            currentIdx = 0;
            timeLeft = 3600;

            document.getElementById('view-dashboard').style.display = 'none';
            document.getElementById('view-quiz').style.display = 'block';
            
            const parts = quizId.split('_');
            const prettyTitle = parts[0].toUpperCase() + ": " + parts.slice(1).join(' ').toUpperCase();
            document.getElementById('quiz-title').innerText = prettyTitle;
            
            setupNavScroll();
            renderQuestion();
            startTimer();
        }

        function showError(msg) { 
            const el = document.getElementById('login-error'); 
            el.innerText = msg; 
            el.style.display = 'block'; 
        }

        function renderQuestion() {
            const q = questions[currentIdx];
            const container = document.getElementById('question-container');
            container.innerHTML = `<h3>Domanda ${currentIdx + 1}</h3><p>${q.question}</p>`;
            
            q.answers.forEach(ans => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.innerHTML = ans.text;
                const saved = answers[currentIdx];
                if(saved && saved.text === ans.text) btn.classList.add('selected');
                btn.onclick = () => selectAnswer(btn, ans);
                container.appendChild(btn);
            });

            document.getElementById('prev-btn').disabled = (currentIdx === 0);
            if(currentIdx === questions.length - 1) {
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('submit-btn').style.display = 'inline-block';
            } else {
                document.getElementById('next-btn').style.display = 'inline-block';
                document.getElementById('submit-btn').style.display = 'none';
            }
            updateNavScroll();
            if(window.MathJax) MathJax.typesetPromise();
        }

        function selectAnswer(btn, ansObj) {
            document.querySelectorAll('.answer-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            answers[currentIdx] = { 
                question: questions[currentIdx].question, 
                choice: ansObj.text, 
                isCorrect: ansObj.correct 
            };
            updateNavScroll();
        }

        function move(dir) { currentIdx += dir; renderQuestion(); }
        
        function setupNavScroll() { 
            const box = document.getElementById('nav-scroll'); box.innerHTML = ""; 
            questions.forEach((_, i) => { 
                const d = document.createElement('div'); d.className = 'nav-box'; d.innerText = i + 1; d.id = `nav-${i}`; 
                d.onclick = () => { currentIdx = i; renderQuestion(); }; 
                box.appendChild(d); 
            }); 
        }
        
        function updateNavScroll() { 
            questions.forEach((_, i) => { 
                const el = document.getElementById(`nav-${i}`); el.className = 'nav-box'; 
                if(answers[i]) el.classList.add('answered'); 
                if(i === currentIdx) el.classList.add('current'); 
            }); 
            document.getElementById(`nav-${currentIdx}`).scrollIntoView({ behavior: 'smooth', inline: 'center' }); 
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
                if(timeLeft <= 0) { clearInterval(timerInterval); submitQuiz(); }
            }, 1000);
        }

        async function submitQuiz() {
            clearInterval(timerInterval);
            document.getElementById('view-quiz').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            let score = 0;
            // Calcolo punteggio massimo (1.5 punti per domanda)
            let maxScore = questions.length * 1.5; 

            let formattedAnswers = [];
            questions.forEach((q, i) => {
                const a = answers[i];
                if(!a) formattedAnswers.push({question: q.question, choice: "SKIPPED"});
                else {
                    if(a.isCorrect) score += 1.5; else score -= 0.4;
                    formattedAnswers.push({question: a.question, choice: a.choice});
                }
            });
            score = Math.round(score * 10) / 10;

            const payload = { 
                email: currentUser, 
                subject: currentQuizId, 
                score: score, 
                maxScore: maxScore,
                answers: formattedAnswers 
            };

            try { 
                await fetch(GOOGLE_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: JSON.stringify(payload) 
                }); 
            } catch(e) {}
            
            alert("Verifica Completata!\n\nPunteggio: " + score + " / " + maxScore);
            location.reload();
        }
    </script>
</body>
</html>
