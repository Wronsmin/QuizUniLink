
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Student Portal</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1, h2 { color: #2c3e50; text-align: center; }
        
        /* LOGIN STYLES */
        input[type="email"] { width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-primary { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1rem; }
        .btn-primary:disabled { background: #ccc; cursor: wait; }
        .error-msg { color: #d9534f; display: none; text-align: center; margin-top: 15px; padding: 10px; background: #fde8e8; border-radius: 4px; }

        /* DASHBOARD LAYOUT */
        .dashboard-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        @media (max-width: 700px) { .dashboard-container { grid-template-columns: 1fr; } }
        
        .column-header { font-size: 1.5rem; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* QUIZ CARDS */
        .quiz-card { 
            border: 1px solid #e0e0e0; 
            border-left: 5px solid #007bff; 
            padding: 15px; margin-bottom: 15px; border-radius: 6px; 
            background: white; cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .quiz-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .type-math { border-left-color: #007bff; }
        .type-physics { border-left-color: #e83e8c; }
        .quiz-card.completed { border-left-color: #28a745; background-color: #f0fff4; opacity: 0.9; cursor: default; }
        
        .card-content { display: flex; flex-direction: column; }
        .quiz-score { font-size: 0.9em; color: #28a745; font-weight: bold; margin-top: 5px; }
        
        .status-badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .badge-todo { background: #e7f1ff; color: #007bff; }
        .badge-done { background: #d4edda; color: #28a745; }

        /* QUIZ INTERFACE */
        .nav-scroll { display: flex; overflow-x: auto; gap: 5px; padding: 10px 0; border-top: 1px solid #eee; margin-top: 20px; }
        .nav-box { min-width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; background: #eee; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .nav-box.answered { background: #007bff; color: white; }
        .nav-box.current { border: 2px solid #ffc107; }
        
        .answer-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 6px; background: white; cursor: pointer; text-align: left; }
        .answer-btn.selected { border-color: #007bff; background: #e7f1ff; }
        
        .nav-container { display: flex; justify-content: space-between; margin-top: 20px; }
        #timer { font-family: monospace; font-size: 1.5rem; color: #d9534f; float: right; }
        #loading { display: none; text-align: center; }
    </style>
</head>
<body>

    <div id="view-login" class="card">
        <h1>Student Portal</h1>
        <p style="text-align:center">Please log in with your school email.</p>
        <input type="email" id="input-email" placeholder="name.surname@school.edu">
        <button id="btn-login" class="btn-primary" onclick="attemptLogin()">Login</button>
        <div id="login-error" class="error-msg"></div>
    </div>

    <div id="view-dashboard" class="card" style="display:none; max-width: 1200px;">
        <h2 id="welcome-msg">Welcome</h2>
        <div class="dashboard-container">
            <div>
                <div class="column-header">üìê Mathematics</div>
                <div id="list-math"></div>
            </div>
            <div>
                <div class="column-header">‚öõÔ∏è Physics</div>
                <div id="list-physics"></div>
            </div>
        </div>
    </div>

    <div id="view-quiz" class="card" style="display:none;">
        <div style="overflow:hidden; margin-bottom:15px;">
            <span id="quiz-title" style="font-weight:bold; font-size:1.2em;">Title</span>
            <span id="timer">60:00</span>
        </div>
        <div id="question-container"></div>
        <div class="nav-container">
            <button id="prev-btn" class="btn-primary" style="background:#6c757d; width:auto;" onclick="move(-1)">Back</button>
            <button id="next-btn" class="btn-primary" style="width:auto;" onclick="move(1)">Next</button>
            <button id="submit-btn" class="btn-primary" style="background:#28a745; width:auto; display:none;" onclick="submitQuiz()">Submit Exam</button>
        </div>
        <div id="nav-scroll" class="nav-scroll"></div>
    </div>
    
    <div id="loading" class="card"><h3>Saving results...</h3></div>

    <script>
        const LIBRARY = {"math_algebra": [{"question": "Which of the following is an irrational number?", "answers": [{"text": "\\(27^{-1/3}\\)", "correct": false}, {"text": "\\(\\sqrt{0.09}\\)", "correct": false}, {"text": "\\(2.\\overline{7}\\)", "correct": false}, {"text": "\\(\\sqrt{8}\\)", "correct": true}]}, {"question": "Which set represents the intersection of the intervals \\((-3, 5]\\) and \\([0, 7)\\)?", "answers": [{"text": "\\((-3, 7)\\)", "correct": false}, {"text": "\\([0, 5)\\)", "correct": false}, {"text": "\\([0, 5]\\)", "correct": true}, {"text": "\\((0, 5]\\)", "correct": false}]}, {"question": "Evaluate: \\( (3^{-1} - 2^{-1})^{-1} \\).", "answers": [{"text": "\\(1/6\\)", "correct": false}, {"text": "\\(6\\)", "correct": false}, {"text": "\\(-1/6\\)", "correct": false}, {"text": "\\(-6\\)", "correct": true}]}, {"question": "If \\(x\\) is a real number such that \\(|x| < 3\\), which inequality describes \\(x\\)?", "answers": [{"text": "\\(-3 < x < 3\\)", "correct": true}, {"text": "\\(x < -3 \\text{ or } x > 3\\)", "correct": false}, {"text": "\\(x > -3\\)", "correct": false}, {"text": "\\(x < 3\\)", "correct": false}]}, {"question": "Simplify the expression \\(\\sqrt{75} - \\sqrt{12}\\).", "answers": [{"text": "\\(\\sqrt{63}\\)", "correct": false}, {"text": "\\(5\\sqrt{3}\\)", "correct": false}, {"text": "\\(2\\sqrt{3}\\)", "correct": false}, {"text": "\\(3\\sqrt{3}\\)", "correct": true}]}, {"question": "Which statement is true for all real numbers \\(a\\) and \\(b\\)?", "answers": [{"text": "\\(\\sqrt{a^2} = a\\)", "correct": false}, {"text": "\\(\\frac{1}{a+b} = \\frac{1}{a} + \\frac{1}{b}\\)", "correct": false}, {"text": "\\(\\sqrt{a^2 + b^2} \\neq a + b\\) (unless one is 0)", "correct": true}, {"text": "\\((a+b)^2 = a^2 + b^2\\)", "correct": false}]}, {"question": "Order the following numbers from smallest to largest: \\(a = 0.2\\), \\(b = 1/4\\), \\(c = (0.2)^2\\).", "answers": [{"text": "\\(c < a < b\\)", "correct": true}, {"text": "\\(a < c < b\\)", "correct": false}, {"text": "\\(a < b < c\\)", "correct": false}, {"text": "\\(c < b < a\\)", "correct": false}]}, {"question": "The price of an item is increased by 20% and then the new price is decreased by 20%. The final price is:", "answers": [{"text": "4% higher than the original price", "correct": false}, {"text": "4% lower than the original price", "correct": true}, {"text": "Equal to the original price", "correct": false}, {"text": "20% lower than the original price", "correct": false}]}, {"question": "Calculate: \\(\\frac{2.4 \\times 10^5}{6.0 \\times 10^{-2}}\\).", "answers": [{"text": "\\(4.0 \\times 10^7\\)", "correct": false}, {"text": "\\(0.4 \\times 10^3\\)", "correct": false}, {"text": "\\(4.0 \\times 10^3\\)", "correct": false}, {"text": "\\(4.0 \\times 10^6\\)", "correct": true}]}, {"question": "What is the value of \\(8^{2/3} \\cdot 16^{-1/2}\\)?", "answers": [{"text": "\\(4\\)", "correct": false}, {"text": "\\(2\\)", "correct": false}, {"text": "\\(1/2\\)", "correct": false}, {"text": "\\(1\\)", "correct": true}]}, {"question": "Find the domain of the function \\(f(x) = \\sqrt{2x - 6}\\).", "answers": [{"text": "\\(x \\neq 3\\)", "correct": false}, {"text": "\\(x \\leq 3\\)", "correct": false}, {"text": "\\(x \\geq 3\\)", "correct": true}, {"text": "\\(x > 3\\)", "correct": false}]}, {"question": "Determine the domain of \\(f(x) = \\frac{1}{x^2 - 1}\\).", "answers": [{"text": "\\(\\mathbb{R}\\)", "correct": false}, {"text": "\\(x \\neq 1\\)", "correct": false}, {"text": "\\((-\\infty, -1) \\cup (-1, 1) \\cup (1, \\infty)\\)", "correct": true}, {"text": "\\((-1, 1)\\)", "correct": false}]}, {"question": "What is the domain of \\(f(x) = \\ln(x+2)\\)?", "answers": [{"text": "\\(x \\neq -2\\)", "correct": false}, {"text": "\\(x > 0\\)", "correct": false}, {"text": "\\(x \\geq -2\\)", "correct": false}, {"text": "\\(x > -2\\)", "correct": true}]}, {"question": "Simplify the algebraic fraction: \\(\\frac{x^3 - 8}{x - 2}\\).", "answers": [{"text": "\\(x^2 - 2x + 4\\)", "correct": false}, {"text": "\\(x^2 + 4\\)", "correct": false}, {"text": "\\(x^2 + 2x + 4\\)", "correct": true}, {"text": "\\(x^2 - 4\\)", "correct": false}]}, {"question": "Solve the inequality: \\(x^2 - 9 < 0\\).", "answers": [{"text": "\\(x > 3\\)", "correct": false}, {"text": "\\(-3 < x < 3\\)", "correct": true}, {"text": "\\(x < 3\\)", "correct": false}, {"text": "\\(x < -3 \\text{ or } x > 3\\)", "correct": false}]}, {"question": "Which of the following values is NOT in the domain of \\(f(x) = \\sqrt{\\frac{x-1}{x+3}}\\)?", "answers": [{"text": "\\(5\\)", "correct": false}, {"text": "\\(1\\)", "correct": false}, {"text": "\\(-4\\)", "correct": false}, {"text": "\\(0\\)", "correct": true}]}, {"question": "Solve the exponential equation: \\(2^{x+1} = \\frac{1}{8}\\).", "answers": [{"text": "\\(x = 4\\)", "correct": false}, {"text": "\\(x = -2\\)", "correct": false}, {"text": "\\(x = -3\\)", "correct": false}, {"text": "\\(x = -4\\)", "correct": true}]}, {"question": "Solve the inequality: \\(e^{2x} > e^x\\).", "answers": [{"text": "All real \\(x\\)", "correct": false}, {"text": "\\(x < 0\\)", "correct": false}, {"text": "\\(x > 1\\)", "correct": false}, {"text": "\\(x > 0\\)", "correct": true}]}, {"question": "Find the solution set for: \\(\\log_2(x) + \\log_2(2) = 4\\).", "answers": [{"text": "\\(x = 8\\)", "correct": true}, {"text": "\\(x = 6\\)", "correct": false}, {"text": "\\(x = 4\\)", "correct": false}, {"text": "\\(x = 16\\)", "correct": false}]}, {"question": "Which expression is equivalent to \\(\\ln(e^x \\cdot e^y)\\)?", "answers": [{"text": "\\(\\ln(x+y)\\)", "correct": false}, {"text": "\\(x + y\\)", "correct": true}, {"text": "\\(e^{x+y}\\)", "correct": false}, {"text": "\\(xy\\)", "correct": false}]}, {"question": "What is the domain of \\(f(x) = \\log_{10}(1 - x^2)\\)?", "answers": [{"text": "\\(x > 1 \\text{ or } x < -1\\)", "correct": false}, {"text": "\\(x < 1\\)", "correct": false}, {"text": "\\(-1 < x < 1\\)", "correct": true}, {"text": "\\(x \\neq \\pm 1\\)", "correct": false}]}, {"question": "Solve the inequality: \\(\\frac{2}{x} > 1\\).", "answers": [{"text": "\\(x > 2\\)", "correct": false}, {"text": "\\(x < 2\\)", "correct": false}, {"text": "\\(0 < x < 2\\)", "correct": true}, {"text": "\\(x > 0\\)", "correct": false}]}, {"question": "Find the value of \\(\\sin(\\frac{\\pi}{6}) + \\cos(\\frac{\\pi}{3})\\).", "answers": [{"text": "\\(1\\)", "correct": true}, {"text": "\\(\\sqrt{3}\\)", "correct": false}, {"text": "\\(\\frac{1}{2}\\)", "correct": false}, {"text": "\\(\\frac{\\sqrt{3}+1}{2}\\)", "correct": false}]}, {"question": "Which of the following is true for an angle \\(x\\) in the second quadrant (\\(\\frac{\\pi}{2} < x < \\pi\\))?", "answers": [{"text": "\\(\\sin(x) > 0, \\cos(x) < 0\\)", "correct": true}, {"text": "\\(\\tan(x) > 0\\)", "correct": false}, {"text": "\\(\\sin(x) > 0, \\cos(x) > 0\\)", "correct": false}, {"text": "\\(\\sin(x) < 0, \\cos(x) < 0\\)", "correct": false}]}, {"question": "Simplify the expression using basic identities: \\(\\frac{\\sin(x)}{\\cos(x)} \\cdot \\frac{1}{\\tan(x)}\\).", "answers": [{"text": "\\(\\tan^2(x)\\)", "correct": false}, {"text": "\\(\\sin^2(x)\\)", "correct": false}, {"text": "\\(1\\)", "correct": true}, {"text": "\\(\\cos^2(x)\\)", "correct": false}]}, {"question": "Solve the equation \\(2\\cos(x) - 1 = 0\\) for \\(0 \\leq x \\leq \\frac{\\pi}{2}\\).", "answers": [{"text": "\\(x = \\frac{\\pi}{4}\\)", "correct": false}, {"text": "\\(x = \\frac{\\pi}{3}\\)", "correct": true}, {"text": "\\(x = \\frac{\\pi}{2}\\)", "correct": false}, {"text": "\\(x = \\frac{\\pi}{6}\\)", "correct": false}]}, {"question": "Which value is equivalent to \\(\\tan(45^\\circ)\\)?", "answers": [{"text": "\\(\\frac{\\sqrt{2}}{2}\\)", "correct": false}, {"text": "\\(\\sqrt{3}\\)", "correct": false}, {"text": "\\(0\\)", "correct": false}, {"text": "\\(1\\)", "correct": true}]}, {"question": "Solve the inequality: \\(\\left(\\frac{1}{3}\\right)^x < 9\\).", "answers": [{"text": "\\(x < -2\\)", "correct": false}, {"text": "\\(x > 2\\)", "correct": false}, {"text": "\\(x > -2\\)", "correct": true}, {"text": "\\(x < 2\\)", "correct": false}]}, {"question": "If \\(\\log_x(32) = 5\\), what is \\(x\\)?", "answers": [{"text": "\\(1\\)", "correct": false}, {"text": "\\(4\\)", "correct": false}, {"text": "\\(3\\)", "correct": false}, {"text": "\\(2\\)", "correct": true}]}, {"question": "The domain of \\(f(x) = \\sqrt{e^x - 1}\\) is:", "answers": [{"text": "\\(x > 0\\)", "correct": false}, {"text": "All real numbers", "correct": false}, {"text": "\\(x \\geq 1\\)", "correct": false}, {"text": "\\(x \\geq 0\\)", "correct": true}]}], "physics_Quantities&Kinematics": [{"question": "Which of the following is a base quantity in the International System of Units (SI)?", "answers": [{"text": "Electric current", "correct": true}, {"text": "Force", "correct": false}, {"text": "Velocity", "correct": false}, {"text": "Electric charge", "correct": false}]}, {"question": "What is the dimensional formula for Force?", "answers": [{"text": "\\([MLT^{-2}]\\) ", "correct": true}, {"text": "\\([MLT^{-1}]\\) ", "correct": false}, {"text": "\\([M^0LT^{-2}]\\)", "correct": false}, {"text": "\\([ML^2T^{-2}]\\) ", "correct": false}]}, {"question": "Which of the following pairs contains only vector quantities?", "answers": [{"text": "Displacement and Acceleration", "correct": true}, {"text": "Mass and Momentum", "correct": false}, {"text": "Force and Work", "correct": false}, {"text": "Speed and Velocity", "correct": false}]}, {"question": "Convert \\(72 \\, km/h\\) into \\(m/s\\).", "answers": [{"text": "\\(20 \\, m/s\\)", "correct": true}, {"text": "\\(25 \\, m/s\\)", "correct": false}, {"text": "\\(10 \\, m/s\\)", "correct": false}, {"text": "\\(15 \\, m/s\\)", "correct": false}]}, {"question": "Two vectors with magnitudes 3 and 4 are perpendicular. What is the magnitude of their resultant?", "answers": [{"text": "\\(1\\)", "correct": false}, {"text": "\\(12\\)", "correct": false}, {"text": "\\(5\\)", "correct": true}, {"text": "\\(7\\)", "correct": false}]}, {"question": "The order of magnitude of the number 0.0034 is:", "answers": [{"text": "\\(10^{3}\\)", "correct": false}, {"text": "\\(10^{-2}\\)", "correct": false}, {"text": "\\(10^{-4}\\)", "correct": false}, {"text": "\\(10^{-3}\\)", "correct": true}]}, {"question": "A car travels 100 meters North and then 100 meters East. What is the magnitude of the total displacement?", "answers": [{"text": "\\(100 \\, m\\)", "correct": false}, {"text": "\\(100\\sqrt{2} \\, m\\)", "correct": true}, {"text": "\\(0 \\, m\\)", "correct": false}, {"text": "\\(200 \\, m\\)", "correct": false}]}, {"question": "Which of the following equations is dimensionally consistent (where \\(x\\) is distance, \\(v\\) is velocity, \\(a\\) is acceleration, \\(t\\) is time)?", "answers": [{"text": "\\(x = \\frac{1}{2}at^2\\)", "correct": true}, {"text": "\\(v = ax\\)", "correct": false}, {"text": "\\(v^2 = 2ax^2\\)", "correct": false}, {"text": "\\(t = \\sqrt{a/x}\\)", "correct": false}]}, {"question": "An object moves with constant velocity. Which statement is true?", "answers": [{"text": "The displacement is always zero.", "correct": false}, {"text": "The average velocity is different from instantaneous velocity.", "correct": false}, {"text": "The speed changes direction.", "correct": false}, {"text": "The acceleration is zero.", "correct": true}]}, {"question": "A car accelerates from rest at \\(2 \\, m/s^2\\). How long does it take to reach a speed of \\(20 \\, m/s\\)?", "answers": [{"text": "\\(5 \\, s\\)", "correct": false}, {"text": "\\(10 \\, s\\)", "correct": true}, {"text": "\\(40 \\, s\\)", "correct": false}, {"text": "\\(20 \\, s\\)", "correct": false}]}, {"question": "If the velocity of a particle is given by \\(v(t) = 4 - 2t\\), at what time does the particle stop?", "answers": [{"text": "\\(2 \\, s\\)", "correct": true}, {"text": "\\(4 \\, s\\)", "correct": false}, {"text": "\\(0 \\, s\\)", "correct": false}, {"text": "\\(1 \\, s\\)", "correct": false}]}, {"question": "An object is dropped from a height. If air resistance is neglected, the distance fallen is proportional to:", "answers": [{"text": "\\(t\\)", "correct": false}, {"text": "\\(t^2\\)", "correct": true}, {"text": "\\(\\sqrt{t}\\)", "correct": false}, {"text": "\\(1/t\\)", "correct": false}]}, {"question": "A stone is dropped from a tower and reaches the ground in 4 seconds. What is the height of the tower? (Assume \\(g = 10 \\, m/s^2\\))", "answers": [{"text": "\\(20 \\, m\\)", "correct": false}, {"text": "\\(80 \\, m\\)", "correct": true}, {"text": "\\(40 \\, m\\)", "correct": false}, {"text": "\\(160 \\, m\\)", "correct": false}]}, {"question": "An object is thrown vertically upwards with a speed of \\(30 \\, m/s\\). How much time does it take to return to the thrower's hand? (Assume \\(g = 10 \\, m/s^2\\))", "answers": [{"text": "\\(1.5 \\, s\\)", "correct": false}, {"text": "\\(3 \\, s\\)", "correct": false}, {"text": "\\(9 \\, s\\)", "correct": false}, {"text": "\\(6 \\, s\\)", "correct": true}]}, {"question": "What represents the area under a Velocity-Time graph?", "answers": [{"text": "Force", "correct": false}, {"text": "Acceleration", "correct": false}, {"text": "Displacement", "correct": true}, {"text": "Speed", "correct": false}]}, {"question": "A car traveling at \\(v\\) stops in distance \\(d\\) under constant braking. If the initial speed was \\(2v\\), the stopping distance would be:", "answers": [{"text": "\\(4d\\)", "correct": true}, {"text": "\\(d\\)", "correct": false}, {"text": "\\(d/2\\)", "correct": false}, {"text": "\\(2d\\)", "correct": false}]}, {"question": "In a projectile motion (neglecting air resistance), which component of velocity remains constant?", "answers": [{"text": "The vertical component", "correct": false}, {"text": "Both components", "correct": false}, {"text": "The horizontal component", "correct": true}, {"text": "Neither component", "correct": false}]}, {"question": "A projectile is fired at an angle of \\(45^\\circ\\) with initial velocity \\(v_0\\). What is its range?", "answers": [{"text": "\\(v_0^2/2g\\)", "correct": false}, {"text": "\\(v_0^2/g\\)", "correct": true}, {"text": "\\(v_0/g\\)", "correct": false}, {"text": "\\(2v_0/g\\)", "correct": false}]}, {"question": "At the maximum height of a projectile's trajectory, the velocity vector is:", "answers": [{"text": "Horizontal", "correct": true}, {"text": "At \\(45^\\circ\\) to the horizontal", "correct": false}, {"text": "Zero", "correct": false}, {"text": "Vertical", "correct": false}]}, {"question": "If a ball is thrown horizontally from a cliff with speed \\(v\\) and another is dropped from the same height simultaneously:", "answers": [{"text": "The thrown ball hits the ground first.", "correct": false}, {"text": "Both hit the ground at the same time.", "correct": true}, {"text": "The dropped ball hits the ground first.", "correct": false}, {"text": "It depends on the mass of the balls.", "correct": false}]}, {"question": "For a projectile, the maximum range is obtained when the angle of projection is:", "answers": [{"text": "\\(45^\\circ\\)", "correct": true}, {"text": "\\(30^\\circ\\)", "correct": false}, {"text": "\\(60^\\circ\\)", "correct": false}, {"text": "\\(90^\\circ\\)", "correct": false}]}, {"question": "A particle moves in a circle of radius \\(r\\) with constant speed \\(v\\). What is its centripetal acceleration?", "answers": [{"text": "\\(r/v\\)", "correct": false}, {"text": "\\(v^2 r\\)", "correct": false}, {"text": "\\(v^2/r\\)", "correct": true}, {"text": "\\(v/r\\)", "correct": false}]}, {"question": "If the period of a uniform circular motion is doubled, the angular velocity:", "answers": [{"text": "Remains the same", "correct": false}, {"text": "Quadruples", "correct": false}, {"text": "Doubles", "correct": false}, {"text": "Is halved", "correct": true}]}, {"question": "A car moves around a circular track of radius \\(100 \\, m\\) at a constant speed of \\(20 \\, m/s\\). What is the angular velocity?", "answers": [{"text": "\\(2000 \\, rad/s\\)", "correct": false}, {"text": "\\(0.2 \\, rad/s\\)", "correct": true}, {"text": "\\(5 \\, rad/s\\)", "correct": false}, {"text": "\\(0.02 \\, rad/s\\)", "correct": false}]}, {"question": "In uniform circular motion, the velocity vector and acceleration vector are always:", "answers": [{"text": "Parallel to each other", "correct": false}, {"text": "Perpendicular to each other", "correct": true}, {"text": "In opposite directions", "correct": false}, {"text": "At \\(45^\\circ\\) to each other", "correct": false}]}, {"question": "An object travels half a circle of radius \\(R\\). What is the magnitude of its displacement?", "answers": [{"text": "\\(0\\)", "correct": false}, {"text": "\\(2R\\)", "correct": true}, {"text": "\\(\\pi R\\)", "correct": false}, {"text": "\\(R\\)", "correct": false}]}, {"question": "A swimmer crosses a river flowing at \\(3 \\, m/s\\) by swimming perpendicular to the current at \\(4 \\, m/s\\). What is the swimmer's speed relative to the ground?", "answers": [{"text": "\\(1 \\, m/s\\)", "correct": false}, {"text": "\\(5 \\, m/s\\)", "correct": true}, {"text": "\\(\\sqrt{7} \\, m/s\\)", "correct": false}, {"text": "\\(7 \\, m/s\\)", "correct": false}]}, {"question": "Which derived unit corresponds to the product of Mass and Acceleration?", "answers": [{"text": "Watt", "correct": false}, {"text": "Newton", "correct": true}, {"text": "Pascal", "correct": false}, {"text": "Joule", "correct": false}]}, {"question": "An object starts from rest and accelerates with constant acceleration \\(a = 4 \\, m/s^2\\). What distance does it cover in \\(3 \\, s\\)?", "answers": [{"text": "\\(6 \\, m\\)", "correct": false}, {"text": "\\(36 \\, m\\)", "correct": false}, {"text": "\\(12 \\, m\\)", "correct": false}, {"text": "\\(18 \\, m\\)", "correct": true}]}, {"question": "A wheel rotates with a frequency of \\(2 \\, Hz\\). What is its period?", "answers": [{"text": "\\(0.25 \\, s\\)", "correct": false}, {"text": "\\(4 \\pi \\, s\\)", "correct": false}, {"text": "\\(2 \\, s\\)", "correct": false}, {"text": "\\(0.5 \\, s\\)", "correct": true}]}]}; 
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbxmPJxEshf-WLe2fA0Bq4YO6hbj7oR8bh2vguUIuIRzJiM8VdBARyYgVbBhOB1W_wgJ/exec";

        let currentUser = "";
        let currentQuizId = "";
        let questions = [];
        let answers = [];
        let currentIdx = 0;
        let timeLeft = 3600;
        let timerInterval;

        async function attemptLogin() {
            const email = document.getElementById('input-email').value.trim();
            const btn = document.getElementById('btn-login');
            
            if(!email.includes('@')) return showError("Invalid email address.");
            btn.disabled = true;
            btn.innerText = "Checking...";
            
            try {
                const response = await fetch(GOOGLE_URL + "?email=" + encodeURIComponent(email));
                const result = await response.json();

                if (!result.allowed) {
                    showError("Access denied. Email not found in whitelist.");
                    btn.disabled = false;
                    btn.innerText = "Login";
                    return;
                }

                currentUser = email;
                document.getElementById('welcome-msg').innerText = "Student: " + email;
                
                renderDashboard(result.completed); 

                document.getElementById('view-login').style.display = 'none';
                document.getElementById('view-dashboard').style.display = 'block';

            } catch (e) {
                console.error(e);
                showError("Connection error or invalid Script URL.");
                btn.disabled = false;
                btn.innerText = "Login";
            }
        }

        function renderDashboard(completedObj) {
            const mathList = document.getElementById('list-math');
            const physList = document.getElementById('list-physics');
            mathList.innerHTML = "";
            physList.innerHTML = "";
            
            if (!completedObj || Array.isArray(completedObj)) completedObj = {}; 

            const quizIds = Object.keys(LIBRARY).sort();

            if(quizIds.length === 0) {
                mathList.innerHTML = "<p>No quizzes available.</p>";
                return;
            }

            quizIds.forEach(quizId => {
                const parts = quizId.split('_');
                const subject = parts[0]; 
                const topic = parts.slice(1).join(' ').toUpperCase(); 
                
                const resultData = completedObj[quizId]; 
                const isDone = !!resultData;
                
                const card = document.createElement('div');
                card.className = `quiz-card type-${subject} ${isDone ? 'completed' : ''}`;
                
                let scoreText = "";
                if (isDone) {
                    const s = resultData.score !== undefined ? resultData.score : "?";
                    const m = resultData.maxScore ? resultData.maxScore : "?";
                    scoreText = `<div class="quiz-score">Score: ${s} / ${m}</div>`;
                }

                card.innerHTML = `
                    <div class="card-content">
                        <strong>${topic}</strong>
                        ${scoreText}
                    </div>
                    <div class="status-badge ${isDone ? 'badge-done' : 'badge-todo'}">
                        ${isDone ? 'COMPLETED' : 'START'}
                    </div>
                `;

                if (!isDone) {
                    card.onclick = () => startQuiz(quizId);
                } else {
                    card.title = "You have already completed this quiz";
                }

                if (subject === 'math') mathList.appendChild(card);
                else if (subject === 'physics') physList.appendChild(card);
                else mathList.appendChild(card); 
            });
        }

        function startQuiz(quizId) {
            currentQuizId = quizId;
            questions = LIBRARY[quizId];
            answers = new Array(questions.length).fill(null);
            currentIdx = 0;
            timeLeft = 3600;

            document.getElementById('view-dashboard').style.display = 'none';
            document.getElementById('view-quiz').style.display = 'block';
            
            const parts = quizId.split('_');
            const prettyTitle = parts[0].toUpperCase() + ": " + parts.slice(1).join(' ').toUpperCase();
            document.getElementById('quiz-title').innerText = prettyTitle;
            
            setupNavScroll();
            renderQuestion();
            startTimer();
        }

        function showError(msg) { 
            const el = document.getElementById('login-error'); 
            el.innerText = msg; 
            el.style.display = 'block'; 
        }

        function renderQuestion() {
            const q = questions[currentIdx];
            const container = document.getElementById('question-container');
            container.innerHTML = `<h3>Question ${currentIdx + 1}</h3><p>${q.question}</p>`;
            
            q.answers.forEach(ans => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.innerHTML = ans.text;
                const saved = answers[currentIdx];
                if(saved && saved.text === ans.text) btn.classList.add('selected');
                btn.onclick = () => selectAnswer(btn, ans);
                container.appendChild(btn);
            });

            document.getElementById('prev-btn').disabled = (currentIdx === 0);
            if(currentIdx === questions.length - 1) {
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('submit-btn').style.display = 'inline-block';
            } else {
                document.getElementById('next-btn').style.display = 'inline-block';
                document.getElementById('submit-btn').style.display = 'none';
            }
            updateNavScroll();
            if(window.MathJax) MathJax.typesetPromise();
        }

        function selectAnswer(btn, ansObj) {
            document.querySelectorAll('.answer-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            answers[currentIdx] = { 
                question: questions[currentIdx].question, 
                choice: ansObj.text, 
                isCorrect: ansObj.correct 
            };
            updateNavScroll();
        }

        function move(dir) { currentIdx += dir; renderQuestion(); }
        
        function setupNavScroll() { 
            const box = document.getElementById('nav-scroll'); box.innerHTML = ""; 
            questions.forEach((_, i) => { 
                const d = document.createElement('div'); d.className = 'nav-box'; d.innerText = i + 1; d.id = `nav-${i}`; 
                d.onclick = () => { currentIdx = i; renderQuestion(); }; 
                box.appendChild(d); 
            }); 
        }
        
        function updateNavScroll() { 
            questions.forEach((_, i) => { 
                const el = document.getElementById(`nav-${i}`); el.className = 'nav-box'; 
                if(answers[i]) el.classList.add('answered'); 
                if(i === currentIdx) el.classList.add('current'); 
            }); 
            document.getElementById(`nav-${currentIdx}`).scrollIntoView({ behavior: 'smooth', inline: 'center' }); 
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
                if(timeLeft <= 0) { clearInterval(timerInterval); submitQuiz(); }
            }, 1000);
        }

        async function submitQuiz() {
            clearInterval(timerInterval);
            document.getElementById('view-quiz').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            let score = 0;
            // 1.5 points per question
            let maxScore = questions.length * 1.5; 

            let formattedAnswers = [];
            questions.forEach((q, i) => {
                const a = answers[i];
                if(!a) formattedAnswers.push({question: q.question, choice: "SKIPPED"});
                else {
                    if(a.isCorrect) score += 1.5; else score -= 0.4;
                    formattedAnswers.push({question: a.question, choice: a.choice});
                }
            });
            score = Math.round(score * 10) / 10;

            const payload = { 
                email: currentUser, 
                subject: currentQuizId, 
                score: score, 
                maxScore: maxScore,
                answers: formattedAnswers 
            };

            try { 
                await fetch(GOOGLE_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: JSON.stringify(payload) 
                }); 
            } catch(e) {}
            
            alert("Quiz Completed!\n\nScore: " + score + " / " + maxScore);
            location.reload();
        }
    </script>
</body>
</html>
